<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Harjun Raskaskone verkkokauppa - Varaosat, huoltopaketit ja tarvikkeet raskaan kaluston ammattilaisille.">
    <title>Verkkokauppa - Harjun Raskaskone Oy</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ========================================
           Design Tokens (from main site)
           ======================================== */
        :root {
            /* Light Industrial Finance Palette */
            --color-bg-primary: #fafbfc;
            --color-bg-secondary: #ffffff;
            --color-bg-tertiary: #f5f7fa;
            --color-bg-card: #ffffff;
            
            /* Text Colors */
            --color-text-primary: #0f1419;
            --color-text-secondary: #4a5568;
            --color-text-muted: #6b7280;
            --color-text-inverse: #ffffff;
            
            /* Steel & Graphite */
            --color-steel-100: #f1f5f9;
            --color-steel-200: #e2e8f0;
            --color-steel-300: #cbd5e1;
            --color-steel-400: #94a3b8;
            --color-steel-500: #64748b;
            --color-steel-600: #475569;
            --color-steel-700: #334155;
            --color-steel-800: #1e293b;
            --color-steel-900: #0f172a;
            
            /* Accent - Refined Blue */
            --color-accent-primary: #2563eb;
            --color-accent-secondary: #3b82f6;
            --color-accent-light: #dbeafe;
            --color-accent-dark: #1e40af;
            
            /* Success & Status */
            --color-success: #10b981;
            --color-success-bg: #d1fae5;
            --color-success-dark: #059669;
            --color-warning: #f59e0b;
            --color-error: #ef4444;
            --color-error-bg: #fee2e2;
            
            /* Spacing */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            --space-3xl: 4rem;
            
            /* Typography */
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;
            
            /* Border */
            --border-radius-sm: 0.375rem;
            --border-radius-md: 0.5rem;
            --border-radius-lg: 0.75rem;
            --border-radius-xl: 1rem;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        }
        
        /* ========================================
           Reset & Base Styles
           ======================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-sans);
            font-size: var(--font-size-base);
            line-height: 1.6;
            color: var(--color-text-primary);
            background: var(--color-bg-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        img {
            max-width: 100%;
            height: auto;
            display: block;
        }
        
        button {
            font-family: inherit;
            cursor: pointer;
            border: none;
            background: none;
        }
        
        input, select, textarea {
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
        }
        
        /* ========================================
           Layout
           ======================================== */
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 var(--space-lg);
        }
        
        /* ========================================
           Header & Navigation
           ======================================== */
        .header {
            background: var(--color-bg-secondary);
            border-bottom: 1px solid var(--color-steel-200);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-lg) 0;
            gap: var(--space-xl);
        }
        
        .logo {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--color-text-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .logo-mark {
            background: var(--color-accent-primary);
            color: white;
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--border-radius-sm);
            font-weight: 700;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
        }
        
        .back-link {
            color: var(--color-text-secondary);
            text-decoration: none;
            font-size: var(--font-size-sm);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            transition: color 0.2s;
        }
        
        .back-link:hover {
            color: var(--color-accent-primary);
        }
        
        .cart-button {
            position: relative;
            background: var(--color-accent-primary);
            color: white;
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--border-radius-md);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            transition: background 0.2s;
        }
        
        .cart-button:hover {
            background: var(--color-accent-dark);
        }
        
        .cart-count {
            background: white;
            color: var(--color-accent-primary);
            padding: 0.125rem var(--space-sm);
            border-radius: 999px;
            font-size: var(--font-size-xs);
            font-weight: 700;
            min-width: 1.5rem;
            text-align: center;
        }
        
        /* ========================================
           Hero Section
           ======================================== */
        .hero {
            background: linear-gradient(135deg, var(--color-steel-900) 0%, var(--color-steel-800) 100%);
            color: white;
            padding: var(--space-3xl) 0;
            text-align: center;
        }
        
        .hero h1 {
            font-size: var(--font-size-4xl);
            font-weight: 700;
            margin-bottom: var(--space-md);
            line-height: 1.2;
        }
        
        .hero p {
            font-size: var(--font-size-lg);
            color: var(--color-steel-300);
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* ========================================
           Main Content
           ======================================== */
        .main {
            padding: var(--space-3xl) 0;
        }
        
        .shop-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: var(--space-2xl);
            align-items: start;
        }
        
        /* ========================================
           Sidebar Filters
           ======================================== */
        .sidebar {
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-steel-200);
            border-radius: var(--border-radius-lg);
            padding: var(--space-lg);
            position: sticky;
            top: 100px;
        }
        
        .sidebar h2 {
            font-size: var(--font-size-lg);
            font-weight: 600;
            margin-bottom: var(--space-lg);
            color: var(--color-text-primary);
        }
        
        .filter-group {
            margin-bottom: var(--space-xl);
        }
        
        .filter-group h3 {
            font-size: var(--font-size-sm);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-secondary);
            margin-bottom: var(--space-md);
        }
        
        .filter-option {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) 0;
            cursor: pointer;
            color: var(--color-text-secondary);
            transition: color 0.2s;
        }
        
        .filter-option:hover {
            color: var(--color-text-primary);
        }
        
        .filter-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--color-accent-primary);
        }
        
        .filter-option label {
            cursor: pointer;
            font-size: var(--font-size-sm);
        }
        
        /* ========================================
           Product Grid
           ======================================== */
        .products-section h2 {
            font-size: var(--font-size-2xl);
            font-weight: 600;
            margin-bottom: var(--space-xl);
            color: var(--color-text-primary);
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-xl);
        }
        
        .product-card {
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-steel-200);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            cursor: pointer;
            position: relative;
        }
        
        .product-card:hover {
            box-shadow: 0 12px 24px -6px rgba(0, 0, 0, 0.12), 0 4px 8px -2px rgba(0, 0, 0, 0.06);
            border-color: var(--color-steel-300);
            transform: translateY(-4px);
        }
        
        .product-image {
            width: 100%;
            height: 240px;
            background: linear-gradient(135deg, var(--color-steel-100) 0%, var(--color-steel-100) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid var(--color-steel-200);
        }
        
        .product-image::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.02) 100%);
        }
        
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .product-card:hover .product-image img {
            transform: scale(1.05);
        }
        
        .product-badge {
            position: absolute;
            top: var(--space-md);
            right: var(--space-md);
            background: var(--color-warning);
            color: white;
            padding: var(--space-xs) var(--space-md);
            border-radius: var(--border-radius-md);
            font-size: var(--font-size-xs);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: var(--shadow-md);
            z-index: 2;
        }
        
        .favorite-btn {
            position: absolute;
            top: var(--space-md);
            left: var(--space-md);
            width: 36px;
            height: 36px;
            background: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            z-index: 2;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            opacity: 0;
            cursor: pointer;
        }
        
        .product-card:hover .favorite-btn {
            opacity: 1;
        }
        
        .favorite-btn:hover {
            background: var(--color-error);
            color: white;
            transform: scale(1.1);
        }
        
        .favorite-btn.active {
            background: var(--color-error);
            color: white;
            opacity: 1;
        }
        
        .product-content {
            padding: var(--space-xl);
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .product-meta {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-sm);
        }
        
        .product-category {
            font-size: var(--font-size-xs);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-muted);
        }
        
        .product-seller {
            font-size: var(--font-size-xs);
            color: var(--color-text-muted);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }
        
        .product-name {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: var(--space-md);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .product-description {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-lg);
            line-height: 1.6;
            flex: 1;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .product-footer {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            gap: var(--space-md);
            padding-top: var(--space-lg);
        }
        
        .product-price-wrapper {
            flex: 1;
        }
        
        .product-price-label {
            font-size: var(--font-size-xs);
            color: var(--color-text-muted);
            margin-bottom: var(--space-xs);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }
        
        .product-price {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--color-text-primary);
            line-height: 1;
        }
        
        .product-price-unit {
            font-size: var(--font-size-sm);
            font-weight: 400;
            color: var(--color-text-muted);
            margin-left: var(--space-xs);
        }
        
        .product-time {
            font-size: var(--font-size-xs);
            color: var(--color-text-muted);
            margin-top: var(--space-xs);
        }
        
        .add-to-cart-btn {
            background: var(--color-accent-primary);
            color: white;
            padding: var(--space-md) var(--space-xl);
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 600;
            font-size: var(--font-size-sm);
            transition: all 0.2s;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(37, 99, 235, 0.2);
            cursor: pointer;
        }
        
        .add-to-cart-btn:hover {
            background: var(--color-accent-dark);
            box-shadow: 0 4px 8px rgba(37, 99, 235, 0.3);
            transform: translateY(-1px);
        }
        
        .add-to-cart-btn:active {
            transform: translateY(0);
        }
        
        .add-to-cart-btn.added {
            background: var(--color-success);
            box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
        }
        
        /* Emoji size classes */
        .product-emoji {
            font-size: 4rem;
        }
        
        .product-emoji-large {
            font-size: 6rem;
        }
        
        .cart-item-emoji {
            font-size: 2rem;
        }
        
        /* Price unit text */
        .price-unit {
            font-size: var(--font-size-xl);
            opacity: 0.9;
        }
        
        /* Icon with margin */
        .icon-with-margin {
            margin-right: 8px;
        }
        
        /* ========================================
           Cart Sidebar
           ======================================== */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            max-width: 450px;
            height: 100vh;
            background: var(--color-bg-secondary);
            box-shadow: var(--shadow-xl);
            transition: right 0.3s ease;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }
        
        .cart-sidebar.open {
            right: 0;
        }
        
        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 999;
        }
        
        .cart-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .cart-header {
            padding: var(--space-xl);
            border-bottom: 1px solid var(--color-steel-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .cart-header h2 {
            font-size: var(--font-size-xl);
            font-weight: 600;
        }
        
        .close-cart-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        
        .close-cart-btn:hover {
            background: var(--color-steel-100);
        }
        
        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-xl);
        }
        
        .cart-empty {
            text-align: center;
            padding: var(--space-3xl) var(--space-xl);
            color: var(--color-text-muted);
        }
        
        .cart-empty svg {
            margin: 0 auto var(--space-lg);
            opacity: 0.3;
        }
        
        .cart-item {
            display: flex;
            gap: var(--space-md);
            padding: var(--space-lg) 0;
            border-bottom: 1px solid var(--color-steel-200);
        }
        
        .cart-item:last-child {
            border-bottom: none;
        }
        
        .cart-item-image {
            width: 80px;
            height: 80px;
            background: var(--color-steel-100);
            border-radius: var(--border-radius-md);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .cart-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: var(--border-radius-md);
        }
        
        .cart-item-details {
            flex: 1;
        }
        
        .cart-item-name {
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: var(--space-xs);
        }
        
        .cart-item-price {
            color: var(--color-text-secondary);
            font-size: var(--font-size-sm);
            margin-bottom: var(--space-md);
        }
        
        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            background: var(--color-steel-100);
            border-radius: var(--border-radius-md);
            padding: var(--space-xs);
        }
        
        .quantity-btn {
            width: 28px;
            height: 28px;
            border-radius: var(--border-radius-sm);
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .quantity-btn:hover {
            background: var(--color-steel-200);
        }
        
        .quantity-display {
            min-width: 32px;
            text-align: center;
            font-weight: 600;
        }
        
        .remove-item-btn {
            color: var(--color-error);
            font-size: var(--font-size-sm);
            font-weight: 500;
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--border-radius-sm);
            transition: all 0.2s;
        }
        
        .remove-item-btn:hover {
            background: var(--color-error-bg);
        }
        
        .cart-summary {
            border-top: 1px solid var(--color-steel-200);
            padding: var(--space-xl);
            background: var(--color-bg-tertiary);
        }
        
        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            font-size: var(--font-size-lg);
        }
        
        .cart-total-label {
            font-weight: 600;
            color: var(--color-text-primary);
        }
        
        .cart-total-value {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--color-accent-primary);
        }
        
        .checkout-btn {
            width: 100%;
            background: var(--color-accent-primary);
            color: white;
            padding: var(--space-lg);
            border-radius: var(--border-radius-md);
            font-weight: 600;
            font-size: var(--font-size-base);
            transition: all 0.2s;
        }
        
        .checkout-btn:hover {
            background: var(--color-accent-dark);
        }
        
        .checkout-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* ========================================
           Product Detail Modal
           ======================================== */
        .product-detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2500;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            padding: var(--space-xl);
            overflow-y: auto;
        }
        
        .product-detail-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .product-detail-content {
            background: var(--color-bg-secondary);
            border-radius: var(--border-radius-xl);
            width: 100%;
            max-width: 1100px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transform: scale(0.95);
            transition: transform 0.3s;
            overflow: hidden;
            max-height: 95vh;
            display: flex;
            flex-direction: column;
        }
        
        .product-detail-modal.active .product-detail-content {
            transform: scale(1);
        }
        
        .product-detail-header {
            padding: var(--space-xl);
            border-bottom: 1px solid var(--color-steel-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--color-bg-tertiary);
        }
        
        .product-detail-header h2 {
            font-size: var(--font-size-2xl);
            font-weight: 600;
            margin: 0;
        }
        
        .product-detail-body {
            overflow-y: auto;
            padding: var(--space-2xl);
        }
        
        .product-detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-3xl);
        }
        
        .product-detail-images {
            position: sticky;
            top: 0;
        }
        
        .product-main-image {
            width: 100%;
            aspect-ratio: 1;
            background: linear-gradient(135deg, var(--color-steel-100) 0%, var(--color-steel-200) 100%);
            border-radius: var(--border-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--color-steel-200);
            overflow: hidden;
            margin-bottom: var(--space-lg);
        }
        
        .product-main-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .product-thumbnails {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-md);
        }
        
        .product-thumbnail {
            aspect-ratio: 1;
            background: var(--color-steel-100);
            border-radius: var(--border-radius-md);
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            overflow: hidden;
        }
        
        .product-thumbnail:hover {
            border-color: var(--color-accent-primary);
        }
        
        .product-thumbnail.active {
            border-color: var(--color-accent-primary);
        }
        
        .product-detail-info h1 {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            color: var(--color-text-primary);
            margin-bottom: var(--space-md);
            line-height: 1.2;
        }
        
        .product-detail-meta {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
            padding: var(--space-lg) 0;
            border-bottom: 1px solid var(--color-steel-200);
            margin-bottom: var(--space-xl);
        }
        
        .product-detail-category {
            font-size: var(--font-size-sm);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-muted);
        }
        
        .product-detail-seller {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }
        
        .product-detail-price-box {
            background: linear-gradient(135deg, var(--color-accent-primary) 0%, var(--color-accent-secondary) 100%);
            color: white;
            padding: var(--space-2xl);
            border-radius: var(--border-radius-lg);
            margin-bottom: var(--space-xl);
        }
        
        .product-detail-price-label {
            font-size: var(--font-size-sm);
            opacity: 0.9;
            margin-bottom: var(--space-sm);
            font-weight: 500;
        }
        
        .product-detail-price {
            font-size: var(--font-size-4xl);
            font-weight: 700;
            line-height: 1;
            margin-bottom: var(--space-xs);
        }
        
        .product-detail-time {
            font-size: var(--font-size-sm);
            opacity: 0.9;
        }
        
        .product-detail-actions {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-2xl);
        }
        
        .product-detail-add-cart {
            flex: 1;
            background: var(--color-success);
            color: white;
            padding: var(--space-lg) var(--space-xl);
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 600;
            font-size: var(--font-size-base);
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            cursor: pointer;
        }
        
        .product-detail-add-cart:hover {
            background: var(--color-success-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(16, 185, 129, 0.4);
        }
        
        .product-detail-favorite {
            width: 56px;
            height: 56px;
            border: 2px solid var(--color-steel-300);
            border-radius: var(--border-radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            background: white;
        }
        
        .product-detail-favorite:hover {
            border-color: var(--color-error);
            color: var(--color-error);
            background: var(--color-error-bg);
        }
        
        .product-detail-description {
            margin-bottom: var(--space-2xl);
        }
        
        .product-detail-description h3 {
            font-size: var(--font-size-xl);
            font-weight: 600;
            margin-bottom: var(--space-md);
            color: var(--color-text-primary);
        }
        
        .product-detail-description p {
            font-size: var(--font-size-base);
            line-height: 1.7;
            color: var(--color-text-secondary);
            margin-bottom: var(--space-md);
        }
        
        .product-detail-specs {
            background: var(--color-bg-tertiary);
            border-radius: var(--border-radius-lg);
            padding: var(--space-xl);
        }
        
        .product-detail-specs h3 {
            font-size: var(--font-size-xl);
            font-weight: 600;
            margin-bottom: var(--space-lg);
            color: var(--color-text-primary);
        }
        
        .product-spec-row {
            display: flex;
            justify-content: space-between;
            padding: var(--space-md) 0;
            border-bottom: 1px solid var(--color-steel-200);
            font-size: var(--font-size-sm);
        }
        
        .product-spec-row:last-child {
            border-bottom: none;
        }
        
        .product-spec-label {
            color: var(--color-text-secondary);
            font-weight: 500;
        }
        
        .product-spec-value {
            color: var(--color-text-primary);
            font-weight: 600;
        }
        
        .product-detail-location {
            margin-top: var(--space-xl);
            padding: var(--space-xl);
            background: var(--color-bg-tertiary);
            border-radius: var(--border-radius-lg);
        }
        
        .product-detail-location h3 {
            font-size: var(--font-size-lg);
            font-weight: 600;
            margin-bottom: var(--space-md);
            color: var(--color-text-primary);
        }
        
        .product-detail-location p {
            color: var(--color-text-secondary);
            margin-bottom: var(--space-sm);
        }
        
        /* ========================================
           Checkout Modal
           ======================================== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: var(--color-bg-secondary);
            border-radius: var(--border-radius-xl);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transform: scale(0.9);
            transition: transform 0.3s;
        }
        
        .modal.active .modal-content {
            transform: scale(1);
        }
        
        .modal-header {
            padding: var(--space-xl);
            border-bottom: 1px solid var(--color-steel-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-header h2 {
            font-size: var(--font-size-2xl);
            font-weight: 600;
        }
        
        .modal-body {
            padding: var(--space-xl);
        }
        
        .form-group {
            margin-bottom: var(--space-lg);
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: var(--space-sm);
            color: var(--color-text-primary);
        }
        
        .form-label.required::after {
            content: " *";
            color: var(--color-error);
        }
        
        .form-input {
            width: 100%;
            padding: var(--space-md);
            border: 1px solid var(--color-steel-300);
            border-radius: var(--border-radius-md);
            font-size: var(--font-size-base);
            transition: all 0.2s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--color-accent-primary);
            box-shadow: 0 0 0 3px var(--color-accent-light);
        }
        
        .form-input.error {
            border-color: var(--color-error);
        }
        
        .form-error {
            color: var(--color-error);
            font-size: var(--font-size-sm);
            margin-top: var(--space-xs);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
        }
        
        .order-summary {
            background: var(--color-bg-tertiary);
            border-radius: var(--border-radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
        }
        
        .order-summary h3 {
            font-size: var(--font-size-lg);
            font-weight: 600;
            margin-bottom: var(--space-md);
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            padding: var(--space-sm) 0;
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }
        
        .order-total {
            display: flex;
            justify-content: space-between;
            padding-top: var(--space-md);
            margin-top: var(--space-md);
            border-top: 2px solid var(--color-steel-300);
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--color-text-primary);
        }
        
        .submit-order-btn {
            width: 100%;
            background: var(--color-success);
            color: white;
            padding: var(--space-lg);
            border-radius: var(--border-radius-md);
            font-weight: 600;
            font-size: var(--font-size-base);
            transition: all 0.2s;
        }
        
        .submit-order-btn:hover {
            background: var(--color-success-dark);
        }
        
        .submit-order-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* ========================================
           Success Message
           ======================================== */
        .success-message {
            text-align: center;
            padding: var(--space-3xl);
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--space-xl);
            background: var(--color-success-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .success-message h3 {
            font-size: var(--font-size-2xl);
            font-weight: 600;
            margin-bottom: var(--space-md);
            color: var(--color-success);
        }
        
        .success-message p {
            color: var(--color-text-secondary);
            margin-bottom: var(--space-xl);
        }
        
        .order-number {
            background: var(--color-steel-100);
            padding: var(--space-md);
            border-radius: var(--border-radius-md);
            font-family: monospace;
            font-size: var(--font-size-lg);
            font-weight: 600;
            margin: var(--space-xl) 0;
        }
        
        /* ========================================
           Responsive
           ======================================== */
        @media (max-width: 1024px) {
            .shop-layout {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: relative;
                top: 0;
            }
            
            .product-detail-grid {
                grid-template-columns: 1fr;
                gap: var(--space-xl);
            }
            
            .product-detail-images {
                position: relative;
            }
        }
        
        @media (max-width: 768px) {
            .hero h1 {
                font-size: var(--font-size-3xl);
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .cart-sidebar {
                max-width: 100%;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-wrap: wrap;
            }
            
            .back-link {
                order: 3;
                width: 100%;
            }
            
            .product-detail-modal {
                padding: 0;
                align-items: flex-start;
            }
            
            .product-detail-content {
                border-radius: 0;
                max-height: 100vh;
            }
            
            .product-detail-body {
                padding: var(--space-xl);
            }
            
            .product-detail-info h1 {
                font-size: var(--font-size-2xl);
            }
            
            .product-detail-price {
                font-size: var(--font-size-3xl);
            }
            
            .product-detail-actions {
                flex-direction: column;
            }
            
            .product-detail-favorite {
                width: 100%;
            }
        }
        
        /* ========================================
           Utilities
           ======================================== */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">
                    <span class="logo-mark">HRK</span>
                    <span>Verkkokauppa</span>
                </a>
                <div class="header-actions">
                    <a href="index.html" class="back-link">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        Takaisin etusivulle
                    </a>
                    <button class="cart-button" id="cartToggle" aria-label="Avaa ostoskori">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="21" r="1"></circle>
                            <circle cx="20" cy="21" r="1"></circle>
                            <path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"></path>
                        </svg>
                        Ostoskori
                        <span class="cart-count" id="cartCount">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Hero -->
    <section class="hero">
        <div class="container">
            <h1>Varaosat ja tarvikkeet ammattilaisille</h1>
            <p>Laadukkaat varaosat, huoltopaketit ja tarvikkeet raskaan kaluston kunnossapitoon. Nopea toimitus p√§√§kaupunkiseudulle.</p>
        </div>
    </section>
    
    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <div class="shop-layout">
                <!-- Sidebar Filters -->
                <aside class="sidebar">
                    <h2>Suodata</h2>
                    
                    <div class="filter-group">
                        <h3>Kategoria</h3>
                        <label class="filter-option">
                            <input type="checkbox" value="varaosat" data-filter="category">
                            <span>Varaosat</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" value="huoltopaketit" data-filter="category">
                            <span>Huoltopaketit</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" value="nesteet" data-filter="category">
                            <span>√ñljyt ja nesteet</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" value="tyokalut" data-filter="category">
                            <span>Ty√∂kalut</span>
                        </label>
                    </div>
                </aside>
                
                <!-- Products -->
                <section class="products-section">
                    <h2>Tuotteet</h2>
                    <div class="products-grid" id="productsGrid">
                        <!-- Products will be rendered here by JavaScript -->
                    </div>
                </section>
            </div>
        </div>
    </main>
    
    <!-- Cart Overlay -->
    <div class="cart-overlay" id="cartOverlay"></div>
    
    <!-- Cart Sidebar -->
    <aside class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h2>Ostoskori</h2>
            <button class="close-cart-btn" id="closeCart" aria-label="Sulje ostoskori">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div class="cart-items" id="cartItems">
            <!-- Cart items will be rendered here -->
        </div>
        <div class="cart-summary" id="cartSummary">
            <div class="cart-total">
                <span class="cart-total-label">Yhteens√§</span>
                <span class="cart-total-value" id="cartTotal">0,00 ‚Ç¨</span>
            </div>
            <button class="checkout-btn" id="checkoutBtn">Siirry kassalle</button>
        </div>
    </aside>
    
    <!-- Checkout Modal -->
    <div class="modal" id="checkoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Kassa</h2>
                <button class="close-cart-btn" id="closeCheckout" aria-label="Sulje kassa">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="checkoutBody">
                <!-- Checkout form will be here -->
            </div>
        </div>
    </div>
    
    <!-- Product Detail Modal -->
    <div class="product-detail-modal" id="productDetailModal">
        <div class="product-detail-content">
            <div class="product-detail-header">
                <h2>Tuotetiedot</h2>
                <button class="close-cart-btn" id="closeProductDetail" aria-label="Sulje tuotetiedot">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="product-detail-body" id="productDetailBody">
                <!-- Product details will be rendered here -->
            </div>
        </div>
    </div>
    
    <script>
        (function() {
            'use strict';
            
            // ========================================
            // Product Catalog
            // ========================================
            // Technical specifications reference:
            // - API CJ-4: American Petroleum Institute standard for heavy-duty diesel engine oils (2006+)
            // - ACEA E7: European Automobile Manufacturers' Association standard for heavy-duty diesel engines
            // - HLP 46: Hydraulic oil classification (ISO VG 46 viscosity grade)
            
            // Default products (fallback if API not available)
            const defaultProducts = [
                {
                    id: 1,
                    name: 'Moottori√∂ljy 15W-40',
                    category: 'nesteet',
                    price: 89.00,
                    unit: '20L',
                    description: 'Laadukas mineraali√∂ljy raskaaseen kalustoon. T√§ytt√§√§ API CJ-4 ja ACEA E7 -vaatimukset.',
                    longDescription: 'Korkealaatuinen moottori√∂ljy, joka on suunniteltu erityisesti raskaan kaluston vaativiin olosuhteisiin. Erinomainen suojaus kulumista vastaan ja pitk√§ vaihtov√§li.',
                    image: 'üõ¢Ô∏è',
                    badge: 'Suosittu',
                    seller: 'Macca Machinery',
                    location: 'Hollola, Suomi',
                    businessId: '1234567-8',
                    timeLeft: 'Aikaa j√§ljell√§ 14 t 56 min',
                    deliveryInfo: 'Nouto 50 ‚Ç¨',
                    specs: {
                        'Tilavuus': '20 litraa',
                        'Viskositeetti': '15W-40',
                        'Standardi': 'API CJ-4, ACEA E7',
                        'Tyyppi': 'Mineraali√∂ljy'
                    }
                },
                {
                    id: 2,
                    name: 'Hydrauli√∂ljy HLP 46',
                    category: 'nesteet',
                    price: 125.00,
                    unit: '20L',
                    description: 'Korkealaatuinen hydrauli√∂ljy ty√∂koneisiin ja nostolaitteisiin.',
                    image: 'üõ¢Ô∏è',
                    seller: 'Macca Machinery',
                    location: 'Hollola, Suomi',
                    specs: {
                        'Tilavuus': '20 litraa',
                        'Viskositeetti': 'ISO VG 46',
                        'Tyyppi': 'Hydrauli√∂ljy'
                    }
                },
                {
                    id: 3,
                    name: '√ñljynsuodatin',
                    category: 'varaosat',
                    price: 24.50,
                    unit: 'kpl',
                    description: 'Yleismalli kuorma-autoihin. Sopii useimpiin Scania, Volvo ja Mercedes-malleihin.',
                    image: '‚öôÔ∏è',
                    badge: 'Uusi',
                    seller: 'Macca Machinery',
                    location: 'Hollola, Suomi',
                    timeLeft: 'Aikaa j√§ljell√§ 13 t 21 min'
                },
                {
                    id: 4,
                    name: 'Ilmansuodatin',
                    category: 'varaosat',
                    price: 45.00,
                    unit: 'kpl',
                    description: 'Tehokas ilmansuodatin dieselmoottoreihin. Pitk√§ k√§ytt√∂ik√§.',
                    image: '‚öôÔ∏è',
                    seller: 'AGCO Suomi Oy',
                    location: 'Viitasaari, Suomi'
                },
                {
                    id: 5,
                    name: 'Polttoainesuodatin',
                    category: 'varaosat',
                    price: 32.00,
                    unit: 'kpl',
                    description: 'Korkealaatuinen polttoainesuodatin. Erottaa veden ja ep√§puhtaudet tehokkaasti.',
                    image: '‚öôÔ∏è',
                    seller: 'Macca Machinery',
                    location: 'Hollola, Suomi'
                },
                {
                    id: 6,
                    name: 'Perushuoltopaketti',
                    category: 'huoltopaketit',
                    price: 450.00,
                    unit: 'pkt',
                    description: 'Sis√§lt√§√§ √∂ljynvaihdon (25L), kaikki suodattimet ja perushuollon kuorma-autolle.',
                    image: 'üì¶',
                    badge: 'Suosittu',
                    seller: 'Hautala Service Oy',
                    location: 'Ilmajoki, Suomi',
                    timeLeft: 'Aikaa j√§ljell√§ 13 t 41 min',
                    specs: {
                        'Sis√§lt√∂': '√ñljynvaihto 25L',
                        'Suodattimet': '√ñljy, ilma, polttoaine',
                        'Tarkastus': 'Perustarkastus sis√§ltyy'
                    }
                },
                {
                    id: 7,
                    name: 'Laaja huoltopaketti',
                    category: 'huoltopaketit',
                    price: 890.00,
                    unit: 'pkt',
                    description: 'Sis√§lt√§√§ √∂ljynvaihdon, kaikki suodattimet, jarrujen tarkastuksen ja erikoistarkastuksen.',
                    image: 'üì¶',
                    seller: 'Hautala Service Oy',
                    location: 'Ilmajoki, Suomi'
                },
                {
                    id: 8,
                    name: 'Ty√∂konehuolto',
                    category: 'huoltopaketit',
                    price: 650.00,
                    unit: 'pkt',
                    description: 'T√§ydellinen huoltopaketti ty√∂koneille. Hydrauliikka, √∂ljyt ja perusteellinen tarkastus.',
                    image: 'üì¶',
                    seller: 'Macca Machinery',
                    location: 'Hollola, Suomi'
                },
                {
                    id: 9,
                    name: 'Jarru√∂ljy DOT 4',
                    category: 'nesteet',
                    price: 18.50,
                    unit: '1L',
                    description: 'Korkean suorituskyvyn jarruneste raskaaseen kalustoon.',
                    image: 'üõ¢Ô∏è',
                    seller: 'Ikka S√§kkinen Ky',
                    location: 'Posio, Suomi'
                },
                {
                    id: 10,
                    name: 'J√§√§hdytinneste',
                    category: 'nesteet',
                    price: 45.00,
                    unit: '5L',
                    description: 'Korkealaatuinen j√§√§hdytinneste. Suojaa -35¬∞C l√§mp√∂tilaan.',
                    image: 'üõ¢Ô∏è',
                    seller: 'Macca Machinery',
                    location: 'Hollola, Suomi'
                },
                {
                    id: 11,
                    name: 'Momenttiavain 1/2"',
                    category: 'tyokalut',
                    price: 189.00,
                    unit: 'kpl',
                    description: 'Ammattilaisen momenttiavain 40-200 Nm. Sertifioitu tarkkuus.',
                    image: 'üîß',
                    badge: 'Pro',
                    seller: 'Cinern-Anniskelu Oy',
                    location: 'Pieks√§m√§ki, Suomi',
                    timeLeft: 'Aikaa j√§ljell√§ 13 t 41 min'
                },
                {
                    id: 12,
                    name: 'Hylsysarja 1/2"',
                    category: 'tyokalut',
                    price: 145.00,
                    unit: 'sarja',
                    description: 'Kattava 24-osainen hylsysarja metallisalkussa. Koot 10-32mm.',
                    image: 'üîß',
                    seller: 'Rakennus ja Kone Latvala',
                    location: 'Kurikka, Suomi'
                }
            ];
            
            // Products array - will be populated from API or fallback
            let products = [];
            
            // ========================================
            // State Management
            // ========================================
            let cart = JSON.parse(localStorage.getItem('cart') || '[]');
            let activeFilters = JSON.parse(localStorage.getItem('activeFilters') || '{"category":[]}');
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            
            // ========================================
            // Helper Functions
            // ========================================
            function saveFilters() {
                localStorage.setItem('activeFilters', JSON.stringify(activeFilters));
            }
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            function formatPrice(price) {
                return price.toFixed(2).replace('.', ',') + ' ‚Ç¨';
            }
            
            function saveCart() {
                localStorage.setItem('cart', JSON.stringify(cart));
            }
            
            function updateCartCount() {
                const count = cart.reduce((sum, item) => sum + item.quantity, 0);
                document.getElementById('cartCount').textContent = count;
            }
            
            function getCartTotal() {
                return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            }
            
            // ========================================
            // Product Rendering
            // ========================================
            function renderProducts() {
                const grid = document.getElementById('productsGrid');
                let filteredProducts = products;
                
                // Apply category filters
                if (activeFilters.category.length > 0) {
                    filteredProducts = products.filter(p => 
                        activeFilters.category.includes(p.category)
                    );
                }
                
                if (filteredProducts.length === 0) {
                    grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--color-text-muted);">Ei tuotteita valituilla suodattimilla.</p>';
                    return;
                }
                
                grid.innerHTML = filteredProducts.map(product => {
                    const isFavorite = favorites.includes(product.id);
                    return `
                    <article class="product-card" data-product-id="${product.id}">
                        <div class="product-image">
                            <button class="favorite-btn ${isFavorite ? 'active' : ''}" data-product-id="${product.id}" data-action="favorite" aria-label="Lis√§√§ suosikkeihin">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="${isFavorite ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="2">
                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                </svg>
                            </button>
                            <div class="product-emoji" role="img" aria-label="${escapeHtml(product.name)}">${escapeHtml(product.image)}</div>
                            ${product.badge ? `<span class="product-badge">${escapeHtml(product.badge)}</span>` : ''}
                        </div>
                        <div class="product-content">
                            <div class="product-meta">
                                <div class="product-category">${escapeHtml(getCategoryName(product.category))}</div>
                                ${product.seller ? `<div class="product-seller">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                        <circle cx="12" cy="10" r="3"></circle>
                                    </svg>
                                    ${escapeHtml(product.seller)}
                                </div>` : ''}
                            </div>
                            <h3 class="product-name">${escapeHtml(product.name)}</h3>
                            <p class="product-description">${escapeHtml(product.description)}</p>
                            <div class="product-footer">
                                <div class="product-price-wrapper">
                                    <div class="product-price-label">Hinta</div>
                                    <div class="product-price">
                                        ${formatPrice(product.price)}
                                        <span class="product-price-unit">/ ${escapeHtml(product.unit)}</span>
                                    </div>
                                    ${product.timeLeft ? `<div class="product-time">${escapeHtml(product.timeLeft)}</div>` : ''}
                                </div>
                                <button class="add-to-cart-btn" data-product-id="${product.id}" data-action="add-cart">
                                    Lis√§√§ koriin
                                </button>
                            </div>
                        </div>
                    </article>
                `;
                }).join('');
                
                // Add event listeners
                grid.querySelectorAll('.add-to-cart-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        handleAddToCart(e);
                    });
                });
                
                grid.querySelectorAll('.favorite-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        handleFavoriteToggle(e);
                    });
                });
                
                grid.querySelectorAll('.product-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        if (!e.target.closest('.add-to-cart-btn') && !e.target.closest('.favorite-btn')) {
                            const productId = parseInt(card.dataset.productId);
                            showProductDetail(productId);
                        }
                    });
                });
            }
            
            function getCategoryName(category) {
                const names = {
                    varaosat: 'Varaosat',
                    huoltopaketit: 'Huoltopaketit',
                    nesteet: '√ñljyt ja nesteet',
                    tyokalut: 'Ty√∂kalut'
                };
                return names[category] || category;
            }
            
            // ========================================
            // Cart Functions
            // ========================================
            function handleAddToCart(e) {
                const btn = e.currentTarget;
                const productId = parseInt(btn.dataset.productId);
                const product = products.find(p => p.id === productId);
                
                if (!product) return;
                
                const existingItem = cart.find(item => item.id === productId);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({
                        id: product.id,
                        name: product.name,
                        price: product.price,
                        unit: product.unit,
                        image: product.image,
                        quantity: 1
                    });
                }
                
                saveCart();
                updateCartCount();
                renderCart();
                
                // Visual feedback
                btn.classList.add('added');
                btn.textContent = 'Lis√§tty!';
                setTimeout(() => {
                    btn.classList.remove('added');
                    btn.textContent = 'Lis√§√§ koriin';
                }, 1000);
            }
            
            function renderCart() {
                const cartItems = document.getElementById('cartItems');
                const cartSummary = document.getElementById('cartSummary');
                
                if (cart.length === 0) {
                    cartItems.innerHTML = `
                        <div class="cart-empty">
                            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                <circle cx="9" cy="21" r="1"></circle>
                                <circle cx="20" cy="21" r="1"></circle>
                                <path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"></path>
                            </svg>
                            <p>Ostoskorisi on tyhj√§</p>
                        </div>
                    `;
                    cartSummary.classList.add('hidden');
                    return;
                }
                
                cartSummary.classList.remove('hidden');
                
                cartItems.innerHTML = cart.map(item => `
                    <div class="cart-item">
                        <div class="cart-item-image">
                            <div class="cart-item-emoji">${escapeHtml(item.image)}</div>
                        </div>
                        <div class="cart-item-details">
                            <div class="cart-item-name">${escapeHtml(item.name)}</div>
                            <div class="cart-item-price">${formatPrice(item.price)} / ${escapeHtml(item.unit)}</div>
                            <div class="cart-item-controls">
                                <div class="quantity-control">
                                    <button class="quantity-btn" data-action="decrease" data-item-id="${item.id}">‚àí</button>
                                    <span class="quantity-display">${item.quantity}</span>
                                    <button class="quantity-btn" data-action="increase" data-item-id="${item.id}">+</button>
                                </div>
                                <button class="remove-item-btn" data-item-id="${item.id}">Poista</button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('cartTotal').textContent = formatPrice(getCartTotal());
                
                // Event listeners
                cartItems.querySelectorAll('.quantity-btn').forEach(btn => {
                    btn.addEventListener('click', handleQuantityChange);
                });
                
                cartItems.querySelectorAll('.remove-item-btn').forEach(btn => {
                    btn.addEventListener('click', handleRemoveItem);
                });
            }
            
            function handleQuantityChange(e) {
                const btn = e.currentTarget;
                const itemId = parseInt(btn.dataset.itemId);
                const action = btn.dataset.action;
                
                const item = cart.find(i => i.id === itemId);
                if (!item) return;
                
                if (action === 'increase') {
                    item.quantity += 1;
                } else if (action === 'decrease') {
                    item.quantity = Math.max(1, item.quantity - 1);
                }
                
                saveCart();
                updateCartCount();
                renderCart();
            }
            
            function handleRemoveItem(e) {
                const btn = e.currentTarget;
                const itemId = parseInt(btn.dataset.itemId);
                
                cart = cart.filter(item => item.id !== itemId);
                
                saveCart();
                updateCartCount();
                renderCart();
            }
            
            // ========================================
            // Cart UI Toggle
            // ========================================
            function toggleCart() {
                const sidebar = document.getElementById('cartSidebar');
                const overlay = document.getElementById('cartOverlay');
                
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
            }
            
            document.getElementById('cartToggle').addEventListener('click', toggleCart);
            document.getElementById('closeCart').addEventListener('click', toggleCart);
            document.getElementById('cartOverlay').addEventListener('click', toggleCart);
            
            // ========================================
            // Checkout
            // ========================================
            document.getElementById('checkoutBtn').addEventListener('click', () => {
                if (cart.length === 0) return;
                
                toggleCart();
                showCheckoutForm();
            });
            
            function showCheckoutForm() {
                const modal = document.getElementById('checkoutModal');
                const body = document.getElementById('checkoutBody');
                
                body.innerHTML = `
                    <div class="order-summary">
                        <h3>Tilausyhteenveto</h3>
                        ${cart.map(item => `
                            <div class="order-item">
                                <span>${escapeHtml(item.name)} √ó ${item.quantity}</span>
                                <span>${formatPrice(item.price * item.quantity)}</span>
                            </div>
                        `).join('')}
                        <div class="order-total">
                            <span>Yhteens√§</span>
                            <span>${formatPrice(getCartTotal())}</span>
                        </div>
                    </div>
                    
                    <form id="checkoutForm">
                        <div class="form-group">
                            <label class="form-label required">Yrityksen nimi</label>
                            <input type="text" class="form-input" name="company" required>
                            <div class="form-error hidden" data-field="company"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required">Y-tunnus</label>
                            <input type="text" class="form-input" name="businessId" required pattern="[0-9]{7,8}-[0-9]">
                            <div class="form-error hidden" data-field="businessId"></div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label required">Yhteyshenkil√∂</label>
                                <input type="text" class="form-input" name="contactPerson" required>
                                <div class="form-error hidden" data-field="contactPerson"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required">Puhelin</label>
                                <input type="tel" class="form-input" name="phone" required>
                                <div class="form-error hidden" data-field="phone"></div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required">S√§hk√∂posti</label>
                            <input type="email" class="form-input" name="email" required>
                            <div class="form-error hidden" data-field="email"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required">Laskutusosoite</label>
                            <input type="text" class="form-input" name="address" required>
                            <div class="form-error hidden" data-field="address"></div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label required">Postinumero</label>
                                <input type="text" class="form-input" name="postalCode" required pattern="[0-9]{5}">
                                <div class="form-error hidden" data-field="postalCode"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required">Postitoimipaikka</label>
                                <input type="text" class="form-input" name="city" required>
                                <div class="form-error hidden" data-field="city"></div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Lis√§tietoja tilauksesta</label>
                            <textarea class="form-input" name="notes" rows="3"></textarea>
                        </div>
                        
                        <button type="submit" class="submit-order-btn">L√§het√§ tilaus</button>
                    </form>
                `;
                
                modal.classList.add('active');
                
                document.getElementById('checkoutForm').addEventListener('submit', handleCheckoutSubmit);
            }
            
            function handleCheckoutSubmit(e) {
                e.preventDefault();
                
                const form = e.target;
                const formData = new FormData(form);
                
                // Validate form
                let isValid = true;
                form.querySelectorAll('[required]').forEach(input => {
                    const error = form.querySelector(`[data-field="${input.name}"]`);
                    
                    // Check if field is empty or invalid pattern
                    const isEmpty = !input.value.trim();
                    const hasInvalidPattern = input.pattern && !input.validity.valid && input.value.trim();
                    
                    if (isEmpty || hasInvalidPattern) {
                        input.classList.add('error');
                        if (error) {
                            let message = 'T√§m√§ kentt√§ on pakollinen';
                            if (isEmpty) {
                                if (input.name === 'businessId') {
                                    message = 'Y-tunnus on pakollinen. K√§yt√§ muotoa 1234567-8 tai 12345678-9.';
                                } else if (input.name === 'postalCode') {
                                    message = 'Postinumero on pakollinen. K√§yt√§ viisinumeroista postinumeroa (esim. 00100).';
                                }
                            } else if (hasInvalidPattern) {
                                if (input.name === 'businessId') {
                                    message = 'Virheellinen Y-tunnus. K√§yt√§ muotoa 1234567-8 tai 12345678-9.';
                                } else if (input.name === 'postalCode') {
                                    message = 'Virheellinen postinumero. K√§yt√§ viisinumeroista postinumeroa (esim. 00100).';
                                } else if (input.type === 'email') {
                                    message = 'Virheellinen s√§hk√∂postiosoite.';
                                }
                            }
                            error.textContent = message;
                            error.classList.remove('hidden');
                        }
                        isValid = false;
                    } else {
                        input.classList.remove('error');
                        if (error) {
                            error.classList.add('hidden');
                        }
                    }
                });
                
                if (!isValid) return;
                
                // Generate order number with random component for uniqueness
                const timestamp = Date.now().toString().slice(-8);
                const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                const orderNumber = 'HRK-' + timestamp + '-' + random;
                
                // In production, this would send to backend
                console.log('Order placed:', {
                    orderNumber,
                    customer: Object.fromEntries(formData),
                    items: cart,
                    total: getCartTotal()
                });
                
                // Show success message
                showOrderSuccess(orderNumber);
                
                // Clear cart
                cart = [];
                saveCart();
                updateCartCount();
                renderCart();
            }
            
            function showOrderSuccess(orderNumber) {
                const body = document.getElementById('checkoutBody');
                
                body.innerHTML = `
                    <div class="success-message">
                        <div class="success-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <h3>Tilaus vastaanotettu!</h3>
                        <p>Kiitos tilauspyynn√∂st√§si. T√§m√§ lomake ei viel√§ l√§het√§ tilausta automaattisesti j√§rjestelm√§√§mme.</p>
                        <div class="order-number">
                            Tilausnumero: ${escapeHtml(orderNumber)}
                        </div>
                        <p style="color: var(--color-text-muted); font-size: var(--font-size-sm);">
                            Tallenna tilausnumerosi ja ota yhteytt√§ myyntiimme toimitus- ja maksutietojen sopimiseksi.
                        </p>
                        <button class="checkout-btn" type="button" id="checkoutSuccessClose">
                            Sulje
                        </button>
                    </div>
                `;
                
                const successCloseButton = document.getElementById('checkoutSuccessClose');
                if (successCloseButton) {
                    successCloseButton.addEventListener('click', () => {
                        const checkoutModal = document.getElementById('checkoutModal');
                        if (checkoutModal) {
                            checkoutModal.classList.remove('active');
                        }
                    });
                    successCloseButton.focus();
                }
            }
            
            const checkoutModal = document.getElementById('checkoutModal');
            const closeCheckoutButton = document.getElementById('closeCheckout');
            
            if (checkoutModal && closeCheckoutButton) {
                closeCheckoutButton.addEventListener('click', () => {
                    checkoutModal.classList.remove('active');
                });
            
                // Allow closing checkout modal by clicking on the backdrop
                checkoutModal.addEventListener('click', (event) => {
                    // Only close when clicking the overlay itself, not its children
                    if (event.target === event.currentTarget) {
                        checkoutModal.classList.remove('active');
                    }
                });
            
                document.addEventListener('keydown', (event) => {
                    if ((event.key === 'Escape' || event.key === 'Esc') && checkoutModal.classList.contains('active')) {
                        checkoutModal.classList.remove('active');
                        closeCheckoutButton.focus();
                    }
                });
            }
            
            // ========================================
            // Filters
            // ========================================
            document.querySelectorAll('[data-filter]').forEach(checkbox => {
                const filterType = checkbox.dataset.filter;
                const value = checkbox.value;
                
                // Restore filter state from localStorage
                if (activeFilters[filterType] && activeFilters[filterType].includes(value)) {
                    checkbox.checked = true;
                }
                
                checkbox.addEventListener('change', (e) => {
                    const filterType = e.target.dataset.filter;
                    const value = e.target.value;
                    
                    if (e.target.checked) {
                        if (!activeFilters[filterType].includes(value)) {
                            activeFilters[filterType].push(value);
                        }
                    } else {
                        activeFilters[filterType] = activeFilters[filterType].filter(v => v !== value);
                    }
                    
                    saveFilters();
                    renderProducts();
                });
            });
            
            // ========================================
            // Favorites
            // ========================================
            
            function handleFavoriteToggle(e) {
                const btn = e.currentTarget;
                const productId = parseInt(btn.dataset.productId);
                
                if (favorites.includes(productId)) {
                    favorites = favorites.filter(id => id !== productId);
                    btn.classList.remove('active');
                } else {
                    favorites.push(productId);
                    btn.classList.add('active');
                }
                
                localStorage.setItem('favorites', JSON.stringify(favorites));
            }
            
            // ========================================
            // Product Detail Modal
            // ========================================
            function showProductDetail(productId) {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                const modal = document.getElementById('productDetailModal');
                const body = document.getElementById('productDetailBody');
                
                const isFavorite = favorites.includes(productId);
                
                body.innerHTML = `
                    <div class="product-detail-grid">
                        <div class="product-detail-images">
                            <div class="product-main-image">
                                <div class="product-emoji-large" role="img" aria-label="${escapeHtml(product.name)}">${escapeHtml(product.image)}</div>
                            </div>
                        </div>
                        
                        <div class="product-detail-info">
                            <h1>${escapeHtml(product.name)}</h1>
                            
                            <div class="product-detail-meta">
                                <div class="product-detail-category">${escapeHtml(getCategoryName(product.category))}</div>
                                ${product.seller ? `<div class="product-detail-seller">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                        <circle cx="12" cy="10" r="3"></circle>
                                    </svg>
                                    ${escapeHtml(product.seller)}
                                </div>` : ''}
                            </div>
                            
                            <div class="product-detail-price-box">
                                <div class="product-detail-price-label">Hinta</div>
                                <div class="product-detail-price">
                                    ${formatPrice(product.price)}
                                    <span class="price-unit">/ ${escapeHtml(product.unit)}</span>
                                </div>
                                ${product.timeLeft ? `<div class="product-detail-time">${escapeHtml(product.timeLeft)}</div>` : ''}
                            </div>
                            
                            <div class="product-detail-actions">
                                <button class="product-detail-add-cart" data-product-id="${product.id}" data-action="add-cart-detail">
                                    <svg class="icon-with-margin" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="9" cy="21" r="1"></circle>
                                        <circle cx="20" cy="21" r="1"></circle>
                                        <path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"></path>
                                    </svg>
                                    Lis√§√§ ostoskoriin
                                </button>
                                <button class="product-detail-favorite ${isFavorite ? 'active' : ''}" data-product-id="${product.id}" data-action="favorite-detail" aria-label="Lis√§√§ suosikkeihin">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="${isFavorite ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="2">
                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="product-detail-description">
                                <h3>Tuotteen kuvaus</h3>
                                <p>${escapeHtml(product.description)}</p>
                                ${product.longDescription ? `<p>${escapeHtml(product.longDescription)}</p>` : ''}
                            </div>
                            
                            ${product.specs ? `
                                <div class="product-detail-specs">
                                    <h3>Tekniset tiedot</h3>
                                    ${Object.entries(product.specs).map(([key, value]) => `
                                        <div class="product-spec-row">
                                            <div class="product-spec-label">${escapeHtml(key)}</div>
                                            <div class="product-spec-value">${escapeHtml(value)}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                            
                            <div class="product-detail-location">
                                <h3>Kohteen sijainti</h3>
                                <p><strong>Toimipiste:</strong> ${escapeHtml(product.location || 'Hollola, Suomi')}</p>
                                <p><strong>Y-tunnus:</strong> ${escapeHtml(product.businessId || '1234567-8')}</p>
                                ${product.deliveryInfo ? `<p><strong>Toimitus:</strong> ${escapeHtml(product.deliveryInfo)}</p>` : ''}
                            </div>
                        </div>
                    </div>
                `;
                
                modal.classList.add('active');
                
                // Event listeners for add to cart and favorite buttons
                const addCartBtn = body.querySelector('[data-action="add-cart-detail"]');
                if (addCartBtn) {
                    addCartBtn.addEventListener('click', (e) => {
                        handleAddToCart(e);
                        // Update button state
                        addCartBtn.innerHTML = `
                            <svg class="icon-with-margin" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                            Lis√§tty ostoskoriin!
                        `;
                        setTimeout(() => {
                            addCartBtn.innerHTML = `
                                <svg class="icon-with-margin" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="9" cy="21" r="1"></circle>
                                    <circle cx="20" cy="21" r="1"></circle>
                                    <path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"></path>
                                </svg>
                                Lis√§√§ ostoskoriin
                            `;
                        }, 2000);
                    });
                }
                
                const favoriteBtn = body.querySelector('[data-action="favorite-detail"]');
                if (favoriteBtn) {
                    favoriteBtn.addEventListener('click', (e) => {
                        handleFavoriteToggle(e);
                        const isFav = favorites.includes(productId);
                        favoriteBtn.classList.toggle('active', isFav);
                        const svg = favoriteBtn.querySelector('svg');
                        if (svg) {
                            svg.setAttribute('fill', isFav ? 'currentColor' : 'none');
                        }
                    });
                }
            }
            
            function closeProductDetail() {
                const modal = document.getElementById('productDetailModal');
                modal.classList.remove('active');
            }
            
            // Product detail modal close handlers
            document.getElementById('closeProductDetail').addEventListener('click', closeProductDetail);
            document.getElementById('productDetailModal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    closeProductDetail();
                }
            });
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const detailModal = document.getElementById('productDetailModal');
                    if (detailModal && detailModal.classList.contains('active')) {
                        closeProductDetail();
                    }
                }
            });
            
            // ========================================
            // Load Products from API
            // ========================================
            async function loadProducts() {
                try {
                    const response = await fetch('api_products.php');
                    const data = await response.json();
                    
                    if (data && data.success && Array.isArray(data.products) && data.products.length > 0) {
                        products = data.products;
                    } else {
                        // Fallback to default products
                        products = defaultProducts;
                    }
                } catch (error) {
                    // Fallback to default products on error
                    products = defaultProducts;
                }
                
                // Render products after loading
                renderProducts();
                renderCart();
                updateCartCount();
            }
            
            // ========================================
            // Initialize
            // ========================================
            loadProducts();
        })();
    </script>
</body>
</html>
